Bölüm 4: Sofistike Çözümler ve Gelişmiş İyileştirmeler
4.1. Temel Düzeltmeler: Pine Script'te Geleceğe Göz Atma Yanlılığını ve Yeniden Boyamayı Ortadan Kaldırmak
Sofistike iyileştirmelere geçmeden önce, stratejinin temelindeki teknik kusurların giderilmesi zorunludur. Tablo 3'te açıklanan prensipler kullanılarak, request.security çağrısı, yalnızca geçmişte kapanmış barların verilerine erişecek şekilde düzeltilmelidir. Bu, `` geçmiş operatörünü kullanarak bir önceki barın değerini almak ve lookahead=barmerge.lookahead_off parametresini ekleyerek geleceğe bakma davranışını kesin olarak engellemekle yapılır.   

Düzeltilmiş ve "dürüst" kod aşağıdaki gibi olacaktır:

Pine Script

//@version=5
strategy("Düzeltilmiş MTF Stratejisi", overlay=true)

// LTF Ayarları
fast_length = 9
slow_length = 21
fast_ema = ta.ema(close, fast_length)
slow_ema = ta.ema(close, slow_length)

// HTF Ayarları
htf_timeframe = "60"
htf_length = 50
// DÜZELTME:  operatörü ve lookahead parametresi eklendi
htf_sma = request.security(syminfo.tickerid, htf_timeframe, ta.sma(close, htf_length), lookahead=barmerge.lookahead_off)

// Koşullar
long_condition = ta.crossover(fast_ema, slow_ema) and close > htf_sma

if (long_condition)
    strategy.entry("Long", strategy.long)

strategy.close("Long", when = ta.crossunder(fast_ema, slow_ema))
Bu düzeltilmiş strateji ile yapılacak bir geriye dönük test, ilk hatalı versiyona kıyasla kaçınılmaz olarak çok daha mütevazı sonuçlar verecektir. Bu, bir hayal kırıklığı değil, aksine üzerine daha gelişmiş katmanlar inşa edilebilecek gerçekçi ve güvenilir bir performans tabanının oluşturulmasıdır.

4.2. Dinamik Rejim Tespiti: Statik Modellerin Ötesine Geçmek
Stratejiyi bir sonraki seviyeye taşımak, onun "rejim körü" doğasını ortadan kaldırmayı gerektirir. Statik bir filtre kullanmak yerine, sistem piyasanın mevcut karakterini analiz etmeli ve stratejisini buna göre uyarlamalıdır. Bu, bir dizi matematiksel araçla gerçekleştirilebilir.

4.2.1. Hurst Üssü: Strateji Seçimi için Piyasa Hafızasını Ölçmek
Hurst Üssü (H), bir zaman serisinin uzun vadeli "hafızasını" veya kalıcılığını ölçen istatistiksel bir araçtır. Değeri 0 ile 1 arasında değişir ve üç temel piyasa rejimini tanımlar:   

H>0.5: Kalıcı (Persistent) veya Trend Yapan Davranış. Geçmişteki bir artışın gelecekteki bir artışı, bir düşüşün ise gelecekteki bir düşüşü takip etme olasılığı yüksektir. Bu rejim, trend takip stratejileri için idealdir.   

H≈0.5: Rastgele Yürüyüş (Random Walk). Geçmiş hareketlerin gelecekteki hareketler hakkında hiçbir bilgi vermediği, hafızasız bir süreçtir. Bu rejimde, ne trend ne de ortalama sapma stratejileri tutarlı bir avantaj sunar.   

H<0.5: Anti-Kalıcı (Anti-Persistent) veya Ortalama Sapan Davranış. Bir artışın bir düşüşü, bir düşüşün ise bir artışı takip etme olasılığı yüksektir. Bu rejim, ortalama sapma stratejileri için uygundur.   

Çözüm: Stratejiye, belirli bir geçmiş veri penceresi (örneğin son 100 bar) üzerinde sürekli olarak Hurst Üssü'nü hesaplayan bir modül eklenir. Ardından, strateji mantığı dinamik hale getirilir:

Eğer H>0.55 (güçlü trend eşiği) ise, orijinal trend takip mantığı (EMA kesişimi + HTF SMA filtresi) aktif hale getirilir.

Eğer H<0.45 (güçlü ortalama sapma eşiği) ise, trend takip modülü devre dışı bırakılır ve yerine RSI gibi bir osilatörle aşırı satım bölgelerinde alım yapan bir ortalama sapma modülü devreye alınır.

Eğer H bu iki eşik arasında kalırsa (0.45≤H≤0.55), piyasanın rastgele ve öngörülemez olduğu kabul edilir ve strateji hiçbir işlem yapmaz.

Bu yaklaşım, stratejiyi tek bir araca sahip bir işçiden, doğru iş için doğru aleti seçebilen bir ustaya dönüştürür.

4.2.2. Shannon Entropisi ve Kurtosis: Bir Volatilite ve Kuyruk Riski Filtresi
Rejim tespiti hangi stratejinin kullanılacağını belirlerken, bir sonraki adım mevcut piyasa koşullarında ne kadar risk alınacağını belirlemektir.

Shannon Entropisi: Bilgi teorisinden gelen entropi, bir sistemdeki belirsizliğin veya düzensizliğin bir ölçüsüdür. Finansal piyasalarda yüksek entropi, yüksek derecede rastgeleliğe, öngörülemezliğe ve genellikle yüksek volatiliteye işaret eder. Çözüm: Stratejiye yuvarlanan bir entropi hesaplaması eklenir. Entropi belirli bir eşiği aştığında, bu durum piyasanın "gürültülü" ve tehlikeli olduğunun bir işareti olarak kabul edilir. Buna yanıt olarak sistem, pozisyon büyüklüklerini otomatik olarak azaltabilir veya yeni pozisyon açmayı tamamen durdurabilir. Bu, Hurst rejiminden bağımsız olarak çalışan bir güvenlik katmanıdır.   

Kurtosis (Basıklık): Getiri dağılımının "kuyruklarının" ne kadar "şişman" olduğunu ölçer. Normal bir dağılıma kıyasla yüksek kurtosis (leptokurtik dağılım), aşırı pozitif veya negatif getirilerin (yani "siyah kuğu" olaylarının) beklenenden daha olası olduğu anlamına gelir. Bu, "kuyruk riski" olarak bilinir. Çözüm: Yuvarlanan bir kurtosis hesaplaması, risk yönetimi için dinamik bir araç olarak kullanılabilir. Kurtosis değeri aniden yükseldiğinde, bu durum büyük ve ani bir fiyat hareketinin olasılığının arttığına dair bir uyarıdır. Sistem, bu uyarıya yanıt olarak zarar durdurma (stop-loss) seviyelerini sıkılaştırabilir veya pozisyon büyüklüğünü azaltarak potansiyel bir piyasa çöküşünden veya ani bir sıçramadan kaynaklanacak büyük kayıplardan korunabilir.   

4.3. Gelişmiş Kontrol ve Optimizasyon Çerçeveleri
En gelişmiş sistemler, sadece piyasayı modellemekle kalmaz, aynı zamanda kendi performanslarını da bir kontrol sistemi olarak yönetirler.

4.3.1. Pozisyon Boyutlandırma için PID Kontrolör Analojisi
Oransal-İntegral-Türevsel (Proportional-Integral-Derivative - PID) kontrolörler, endüstriyel otomasyondan termostatlara kadar sayısız alanda kullanılan, bir sistemin çıktısını istenen bir ayar noktasında (setpoint) tutmak için tasarlanmış geri besleme kontrol döngüsü algoritmalarıdır. Basit, sağlam ve geniş bir uygulama alanına sahip olmaları en büyük avantajlarıdır.   

Çözüm (Analojik Uygulama): Bu mühendislik konsepti, algoritmik ticaretin risk yönetimine yenilikçi bir şekilde uygulanabilir. Bu çerçevede:

Süreç Değişkeni (Process Variable - PV): Stratejinin mevcut sermaye eğrisi (equity curve).

Ayar Noktası (Setpoint - SP): İdeal veya hedeflenen performans. Bu, sermaye eğrisinin 50 periyotluk hareketli ortalaması gibi dinamik bir hedef olabilir.

Hata (Error): Mevcut sermaye ile Ayar Noktası arasındaki fark, yani mevcut düşüş (drawdown).

Bu hata sinyali, PID kontrolörünün üç bileşenini besler:

Oransal (P) Kontrol: Hata ne kadar büyükse (yani düşüş ne kadar derinse), risk azaltma tepkisi de o kadar büyük olur. Örneğin, %10'luk bir düşüş, pozisyon büyüklüğünün %20 azaltılmasına neden olurken, %20'lik bir düşüş %40'lık bir azaltmaya yol açabilir.

İntegral (I) Kontrol: Hata zamanla birikir. Uzun süren ancak küçük bir düşüş bile "integral hatasını" artırır ve bu da zamanla riskin kademeli ama kararlı bir şekilde azaltılmasına yol açar. Bu, "binlerce küçük kesikle ölüm" senaryosunu önler. Kontrol teorisindeki "integral windup" kavramı , uzun süren bir düşüş sırasında kaybeden pozisyona ekleme yapmanın tehlikesine bir analoji olarak görülebilir.   

Türevsel (D) Kontrol: Hatanın değişim hızını ölçer. Sermaye eğrisindeki ani ve keskin bir düşüş (hızlı artan bir düşüş), türevsel terimi tetikler ve felaketi önlemek için agresif ve anında bir risk azaltımı (örneğin, tüm pozisyonların kapatılması) uygular.

Bu PID katmanı, tüm ticaret sistemi üzerinde çalışan, dinamik ve kendi performansına duyarlı bir üst düzey risk yöneticisi görevi görür.

4.3.2. Doğrusal Olmayan Dinamiklerin Entegrasyonu: Bir Kaos Filtresi Olarak Lyapunov Üssü
Hurst, Entropi ve Kurtosis gibi araçlar sistemin farklı piyasa koşullarında gezinmesine yardımcı olurken, Lyapunov üssü daha temel bir soruyu yanıtlar: "Piyasa şu anda modellenebilir bir durumda mı?".   

Çözüm: Bu, sistemin nihai "ana şalteri" olarak tasarlanır. Yuvarlanan Lyapunov üssü hesaplaması, güçlü bir şekilde pozitif bir değere ulaştığında, bu durum sistemin deterministik modellerin ve istatistiksel ilişkilerin çöktüğü kaotik bir faza girdiğinin sinyalidir. Bu durumda, en akıllıca hareket, hiçbir şey yapmamaktır. Hurst rejimi ne olursa olsun, entropi ne kadar düşük olursa olsun, pozitif bir Lyapunov üssü, tüm algoritmik sistemin geçici olarak devre dışı bırakılması için bir emirdir. Sistem, üs tekrar nötr veya negatif bir değere dönene kadar beklemede kalır. Bu, modelin öngörülemeyen "siyah kuğu" ortamlarında feci şekilde başarısız olmasını önleyen nihai savunma mekanizmasıdır.   

Bu çözümler silsilesi, bir nicel yatırımcının olgunlaşma sürecini yansıtan bir sofistikasyon hiyerarşisi ortaya koyar. İlk seviye, teknik hataları düzeltmektir (4.1). İkinci seviye, piyasanın karakterine uyum sağlamaktır (4.2). Üçüncü ve en üst seviye ise, sistemin kendi çıktısını (sermaye eğrisini) başlı başına dinamik bir süreç olarak yönetmektir (4.3). Bu, en gelişmiş algoritmik ticaret sistemlerinin tek bir "sinyal üretici" olmadığını, aksine birbiriyle etkileşen modellerden oluşan katmanlı ekosistemler olduğunu gösterir. Bu sistemler, piyasa modellerini (Hurst), risk modellerini (Entropi, Kurtosis) ve kendi performans modellerini (PID analojisi) içerir. Bu modüler, hiyerarşik tasarım, her şeyi tek seferde yapmaya çalışan tek ve karmaşık bir modelden çok daha sağlam ve dayanıklıdır.

Bölüm 5: Sonuç ve Stratejik Değerlendirme
Bu rapor, "İleri Düzey Algoritmik Ticaret" kavramını, basit ama kritik derecede kusurlu bir otomatik stratejiden başlayarak, çok katmanlı, uyarlanabilir ve matematiksel olarak sağlam bir sisteme doğru evrilen bir yolculuk olarak ele almıştır. Analiz, sezgisel olarak çekici gelen bir çok zaman dilimli trend filtresi stratejisinin, "geleceğe göz atma yanlılığı" ve "yeniden boyama" gibi temel teknik kusurlar nedeniyle gerçek dünya ticaretinde nasıl başarısız olmaya mahkum olduğunu göstermiştir.

Ardından, bu temel kusurları gidermenin ötesine geçerek, bir stratejiyi gerçekten "ileri düzey" yapan unsurlar incelenmiştir. Çözüm, daha iyi bir giriş sinyali bulmakta değil, piyasanın sürekli değişen, durağan olmayan doğasını anlayan ve buna uyum sağlayan sağlam bir çerçeve inşa etmekte yatmaktadır. Bu çerçeve, aşağıdaki gibi sofistike katmanları içermektedir:

Dinamik Rejim Tespiti: Hurst Üssü gibi araçlarla piyasanın trend mi, ortalama sapma mı yoksa rastgele mi davrandığını belirleyerek, doğru stratejiyi doğru zamanda uygulamak.

Dinamik Risk Yönetimi: Shannon Entropisi ve Kurtosis gibi ölçütlerle piyasanın belirsizliğini ve kuyruk riskini sürekli olarak değerlendirerek pozisyon büyüklüğünü ve risk maruziyetini anlık olarak ayarlamak.

Sistemik Performans Kontrolü: PID kontrolör analojisi gibi mühendislik yaklaşımlarını kullanarak, sistemin kendi sermaye eğrisini bir süreç olarak yönetmek ve düşüşlere (drawdown) akıllıca tepki vermek.

Kaos Filtreleme: Lyapunov Üssü gibi doğrusal olmayan dinamik araçlarla, piyasanın modellenebilirliğinin sınırlarına geldiği kaotik dönemleri tespit edip, model çökmesini önlemek için sistemi tamamen devre dışı bırakmak.

Bu yolculuk, ileri düzey algoritmik ticaretin, tek bir mükemmel algoritma arayışından ziyade, farklı matematiksel ve istatistiksel araçların uzmanlaşmış roller üstlendiği modüler bir sistem mühendisliği yaklaşımı olduğunu ortaya koymaktadır.

Sonuç olarak, bu alanda başarıya ulaşmak isteyen her yatırımcı için en kritik çıkarım, titiz ve istatistiksel olarak sağlam doğrulama yöntemlerinin pazarlık edilemez önemidir. Geleceğe göz atma yanlılığı gibi uygulama detaylarını hesaba katmayan ve aşırı uyum (overfitting) tehlikesini göz ardı eden herhangi bir geriye dönük test, değersizdir. Profesyonel düzeyde araştırma, aynı zamanda, çok sayıda strateji veya parametre kombinasyonu denendiğinde, istatistiksel anlamlılık çıtasının, şans eseri bulunan sahte keşifleri elemek için yükseltilmesi gerektiğini de kabul eder. Nihayetinde, piyasayı yenmek, yalnızca akıllı bir stratejiye sahip olmakla değil, aynı zamanda o stratejinin geçerliliğini kanıtlama sürecinde kendine karşı acımasızca dürüst olmakla mümkündür.   

